var Game={w:800,h:600};Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.stage.backgroundColor="#FFF",this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png")},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=this.game.add.text(Game.w,Game.h,"Loading...",{font:"30px Helvetica",fill:"#000"});t.anchor.setTo(.5,.5);var e=this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading");this.game.load.setPreloadSprite(e)},create:function(){this.game.state.start("Menu")}},Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){this.title=this.game.add.sprite(Game.w/2,Game.h/2-100,"title"),this.title.anchor.setTo(.5,.5),this.instructions=this.game.add.sprite(Game.w/2+200,200,"instructions"),this.instructions.scale.x=.5,this.instructions.scale.y=.5;var t=this.game.add.text(Game.w/2,Game.h/2-50,"~click to start~",{font:"30px Helvetica",fill:"#000"});t.anchor.setTo(.5,.5)},update:function(){this.game.input.activePointer.isDown&&this.game.state.start("Play")}};var wKey,aKey,sKey,dKey;Game.Play=function(t){this.game=t},Game.Play.prototype={create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.game.stage.backgroundColor="#FFF",this.game.add.sprite(0,0,this.circlebmd),wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),this.dots=new Dots(this.game),this.dots.create(),this.dots.initialBoard()},update:function(){},render:function(){this.game.debug.text("this.selected "+this.dots.selected,32,32),this.game.debug.text("this.scoreList "+this.dots.scoreList,32,64),this.game.debug.text("this.score"+this.dots.score,32,96)}};var Dots=function(t){this.game=t,this.boardWidth=8,this.boardHeight=7,this.board=[],this.idCount=0,this.selected=null,this.scoreList=[],this.score=0};Dots.prototype={create:function(){var t=42;this.circlebmd=this.game.add.bitmapData(t,t),this.circlebmd.circle(t/2,t/2,t/2,"#FFFFFF"),this.dots=this.game.add.group(),this.dots.createMultiple(64,this.circlebmd),this.dots.setAll("anchor.x",.5),this.dots.setAll("anchor.y",.5),this.linebmd=this.game.add.bitmapData(800,600),this.linebmd.ctx.lineWidth="4",this.linebmd.ctx.strokeColor="#000000",this.linebmd.ctx.stroke(),this.guideLine=this.game.add.sprite(0,0,this.linebmd),this.colors=[16711680,255,16776960,65535,65280]},initialBoard:function(){this.board=[];for(var t=0;t<this.boardWidth;t++){for(var e=[],i=0;i<this.boardHeight;i++){var s=this.addDot();e.push(s)}this.board.push(e)}return this.drawBoard(),this.board},clickDot:function(t){this.selected=t,this.scoreList.push(t)},overDot:function(t){if(null!==this.selected){this.scoreList[this.scoreList.length-2]===t?(this.scoreList.pop(),this.selected=t):this.scoreList.indexOf(t)>-1&&this.scoreList.length>3?this.looped=!0:this.isAdjacent(this.selected,t)&&this.selected.tint===t.tint&&(console.log("over"+t._id),this.selected=t,-1===this.scoreList.indexOf(t)&&this.scoreList.push(t)),this.linebmd.clear(),this.linebmd.ctx.beginPath(),console.log("#"+("00000"+this.selected.tint.toString(16)).substr(-6)),this.linebmd.ctx.strokeStyle="#"+("00000"+this.selected.tint.toString(16)).substr(-6),this.linebmd.ctx.moveTo(this.scoreList[0].x,this.scoreList[0].y);for(var e=0;e<this.scoreList.length-1;e++){var i=this.scoreList[e+1];console.log("x"+i.x+" y"+i.y),this.linebmd.ctx.lineTo(i.x,i.y)}this.looped===!0&&this.linebmd.ctx.lineTo(t.x,t.y),this.linebmd.ctx.lineWidth=4,this.linebmd.ctx.stroke(),this.linebmd.ctx.closePath()}},upDot:function(){this.linebmd.clear(),this.looped===!0&&this.looper(),this.score+=this.scorePoints(),this.scoreList=[],this.selected=null,this.drawBoard()},looper:function(){for(var t=0;t<this.boardWidth;t++)for(var e=0;e<this.boardHeight;e++){var i=this.board[t][e];console.log("color"+i.tint),this.selected.tint===i.tint&&this.scoreList.push(i)}this.looped=!1},scorePoints:function(){if(1===this.scoreList.length)return 0;var t=[];this.scoreList.forEach(function(e){t.push(e._id)},this);for(var e=0;e<this.boardWidth;e++)for(var i=0;i<this.boardHeight;i++){var s=this.board[e][i];t.indexOf(s._id)>-1&&(s.kill(),this.board[e].splice(i,1),this.board[e].push(this.addDot()),i--)}return this.scoreList.length},addDot:function(){var t=this.game.rnd.between(0,4),e=this.dots.getFirstDead();return e._id=this.idCount,e.spriteNum=t,e.tint=this.colors[t],e.inputEnabled=!0,e.events.onInputDown.add(this.clickDot,this),e.events.onInputUp.add(this.upDot,this),e.events.onInputOver.add(this.overDot,this),e.reset(this.game.world.centerX,-this.game.world.centerY),this.idCount++,e},drawBoard:function(){for(var t=0;t<this.boardWidth;t++)for(var e=0;e<this.boardHeight;e++){var i=64*t+80,s=500-64*e,a=this.board[t][e];if(a.scale.x=1,a.scale.y=1,a.x!==i||a.y!==s){this.game.add.tween(a).to({x:i,y:s},300).start()}}},getPosition:function(t){for(var e=0;e<this.boardWidth;e++){var i=this.board[e].indexOf(t);if(i>-1)return{i:e,j:i}}return{}},isAdjacent:function(t,e){var i=this.getPosition(t),s=this.getPosition(e);return(s.i!==i.i||s.j!==i.j-1&&s.j!==i.j+1)&&(s.j!==i.j||s.i!==i.i-1&&s.i!==i.i+1)?!1:!0}};var game=new Phaser.Game(Game.w,Game.h,Phaser.AUTO,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Play",Game.Play),game.state.start("Boot");