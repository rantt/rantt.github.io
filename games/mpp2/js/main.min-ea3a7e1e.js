function rand(t,e){return Math.floor(Math.random()*(e-t+1))+t}function rand(t,e){return Math.floor(Math.random()*(e-t+1))+t}var Game={w:800,h:600};localStorage.setItem("atPlayer",rand(0,1e6)),Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.stage.backgroundColor="#FFF",this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml")},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=(this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","Loading...",30).anchor.setTo(.5),this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading"));this.game.load.setPreloadSprite(t),this.game.load.image("twitter","assets/images/twitter.png"),this.game.load.spritesheet("tiles","assets/images/tiles2.png",32,32,2),this.game.load.spritesheet("hero","assets/images/players.png",32,32,7)},create:function(){this.game.state.start("Menu")}};var Actor=function(t,e,i,a,r,o){this.game=t,this.map=e,this.isMoving=!1,Phaser.Sprite.call(this,this.game,32*i,32*a,r),this.frame=o,this.marker=new Phaser.Point(i,a),this.game.physics.arcade.enable(this),this.body.fixedRotation=!0,this.body.moves=!1,this.game.add.existing(this),this.direction="down"};Actor.prototype=Object.create(Phaser.Sprite.prototype),Actor.prototype.moveTo=function(t,e){this.isMoving||this.cantMove(t,e)||(this.isMoving=!0,this.game.add.tween(this).to({x:this.x+32*t,y:this.y+32*e},120,Phaser.Easing.Linear.None,!0).onComplete.add(function(){this.marker.x+=t,this.marker.y+=e,this.isMoving=!1},this))},Actor.prototype.cantMove=function(t,e){if(this.inCombat)return!0;var i=this.marker.x+t,a=this.marker.y+e,r=this.map.getTile(i,a,0);return null===r?!0:this.map.getTile(i,a,0).collideDown?!0:void 0},Actor.prototype.constructor=Actor,Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){this.game.stage.backgroundColor="#000",this.titleText=this.game.add.bitmapText(Game.w/2,Game.h/2-100,"minecraftia","Multiplayer Part 2",42),this.titleText.anchor.setTo(.5),this.titleText.tint=255,this.game.add.tween(this.titleText).to({y:300},1e3,Phaser.Easing.Linear.In,!0,0,-1).yoyo(!0);this.game.add.bitmapText(Game.w/2,Game.h/2+50,"minecraftia","~click to start~",24).anchor.setTo(.5)},update:function(){this.game.input.activePointer.isDown&&this.game.state.start("Play")}};var wKey,aKey,sKey,dKey,score=0,fireRef,player,cursors,leftArrow,rightArrow,upArrow,downArrow,actors={};Game.Play=function(t){this.game=t},Game.Play.prototype={init:function(){this.game.physics.startSystem(Phaser.Physics.ARCADE)},create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),cursors=this.game.input.keyboard.createCursorKeys();var t=new Firebase("https://mpp2.firebaseio.com/");FLOOR=0,WALL=1;var e="1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,1,1,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1\n0,1,1,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1\n0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1\n0,0,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1\n0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1\n1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1\n1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n0,0,1,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n1,1,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1\n1,1,0,0,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1";game.load.tilemap("level",null,e,Phaser.Tilemap.CSV),map=game.add.tilemap("level",32,32),map.addTilesetImage("tiles"),layer=map.createLayer(0),map.setCollision(WALL),layer.resizeWorld(),player=new Actor(this.game,map,5,5,"hero",rand(0,6)),player.uid=parseInt(JSON.parse(localStorage.getItem("atPlayer"))),player.movements=function(){if(!this.tweening){var e={};cursors.left.isDown||leftArrow?(this.moveTo(-1,0),this.direction="left",e[player.uid]={direction:this.direction,x:this.x,y:this.y,frame:this.frame,uid:this.uid},t.set(e)):cursors.right.isDown||rightArrow?(this.moveTo(1,0),this.direction="right",e[player.uid]={direction:this.direction,x:this.x,y:this.y,frame:this.frame,uid:this.uid},t.set(e)):cursors.up.isDown||upArrow?(this.moveTo(0,-1),this.direction="up",e[player.uid]={direction:this.direction,x:this.x,y:this.y,frame:this.frame,uid:this.uid},t.set(e)):(cursors.down.isDown||downArrow)&&(this.moveTo(0,1),this.direction="down",e[player.uid]={direction:this.direction,x:this.x,y:this.y,frame:this.frame,uid:this.uid},t.set(e))}},t.on("child_changed",function(t){var e=t.val();e.uid!==player.uid&&(void 0===actors[e.uid]?actors[e.uid]=new Actor(game,map,e.x,e.y,"hero",e.frame):(actors[e.uid].x=e.x,actors[e.uid].y=e.y,"left"===e.direction?actors[e.uid].moveTo(-1,0):"right"===e.direction?actors[e.uid].moveTo(1,0):"up"===e.direction?actors[e.uid].moveTo(0,-1):"down"===e.direction&&actors[e.uid].moveTo(0,1)))}),wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),this.game.camera.follow(player,Phaser.Camera.FOLLOW_PLATFORMER),this.loadTouchControls(),this.twitterButton=this.game.add.button(this.game.world.centerX,this.game.world.centerY+200,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.visible=!1},loadTouchControls:function(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var t=80;this.arrowbmd=this.game.add.bitmapData(t,t),this.arrowbmd.ctx.clearRect(0,0,t,t),this.arrowbmd.ctx.strokeStyle="white",this.arrowbmd.ctx.lineWidth=2,this.arrowbmd.ctx.fill(),this.arrowbmd.ctx.beginPath(),this.arrowbmd.ctx.moveTo(1*t/2,0),this.arrowbmd.ctx.lineTo(0,1*t/2),this.arrowbmd.ctx.lineTo(1*t/4,1*t/2),this.arrowbmd.ctx.lineTo(1*t/4,t),this.arrowbmd.ctx.lineTo(3*t/4,t),this.arrowbmd.ctx.lineTo(3*t/4,1*t/2),this.arrowbmd.ctx.lineTo(t,1*t/2),this.arrowbmd.ctx.fill(),this.upArrow=this.game.add.sprite(140,Game.h-160,this.arrowbmd),this.upArrow.tint=14474460,this.upArrow.alpha=.5,this.upArrow.anchor.setTo(.5,.5),this.upArrow.inputEnabled=!0,this.upArrow.fixedToCamera=!0,this.upArrow.events.onInputDown.add(function(){upArrow=!0},this),this.upArrow.events.onInputUp.add(function(){upArrow=!1},this),this.downArrow=this.game.add.sprite(140,Game.h-40,this.arrowbmd),this.downArrow.tint=14474460,this.downArrow.alpha=.5,this.downArrow.anchor.setTo(.5,.5),this.downArrow.inputEnabled=!0,this.downArrow.angle=180,this.downArrow.fixedToCamera=!0,this.downArrow.events.onInputDown.add(function(){downArrow=!0},this),this.downArrow.events.onInputUp.add(function(){downArrow=!1},this),this.leftArrow=this.game.add.sprite(60,Game.h-100,this.arrowbmd),this.leftArrow.tint=14474460,this.leftArrow.alpha=.5,this.leftArrow.anchor.setTo(.5,.5),this.leftArrow.inputEnabled=!0,this.leftArrow.fixedToCamera=!0,this.leftArrow.angle=-90,this.leftArrow.events.onInputDown.add(function(){leftArrow=!0},this),this.leftArrow.events.onInputUp.add(function(){leftArrow=!1},this),this.rightArrow=this.game.add.sprite(220,Game.h-100,this.arrowbmd),this.rightArrow.tint=14474460,this.rightArrow.alpha=.5,this.rightArrow.anchor.setTo(.5,.5),this.rightArrow.inputEnabled=!0,this.rightArrow.angle=90,this.rightArrow.fixedToCamera=!0,this.rightArrow.events.onInputDown.add(function(){rightArrow=!0},this),this.rightArrow.events.onInputUp.add(function(){rightArrow=!1},this)}},update:function(){player.movements()},twitter:function(){var t="http://www.divideby5.com/games/GAMETITLE/",e="rantt_",i=["1GAM"];window.open("http://twitter.com/share?text=My+best+score+is+"+score+"+playing+GAME+TITLE+See+if+you+can+beat+it.+at&via="+e+"&url="+t+"&hashtags="+i.join(","),"_blank")}};var game=new Phaser.Game(Game.w,Game.h,Phaser.AUTO,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Play",Game.Play),game.state.start("Boot");