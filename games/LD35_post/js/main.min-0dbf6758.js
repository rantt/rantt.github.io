var tileSize=32,rows=20,cols=25,Game={w:tileSize*cols,h:tileSize*rows,camera:{x:2,y:1},respawn:{x:2e3,y:1216}};Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.stage.backgroundColor="#FFF",this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml"),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.maxHeight=window.innerHeight,this.game.scale.maxWidth=window.innerHeight*(Game.w/Game.h)},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=(this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","Loading...",30).anchor.setTo(.5),this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading"));this.game.load.setPreloadSprite(t),this.game.load.image("twitter","assets/images/twitter.png"),this.game.load.spritesheet("shapes","assets/images/shapes.png",48,48,5),this.game.load.spritesheet("tiles","assets/images/tiles.png",32,32,3),this.game.load.tilemap("world","assets/atlas/world.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.audio("music","assets/audio/music.wav"),this.game.load.audio("jump","assets/audio/jump.wav")},create:function(){this.game.state.start("Menu")}};var Player=function(t,e,a){this.game=t,this.jumpSnd=this.game.add.sound("jump"),this.jumpSnd.volume=.3,this.JUMP_SPEED=-550,this.MOVE_SPEED=300,this.triangleUnlocked=!1,this.bowtieUnlocked=!1,this.circleUnlocked=!1,this.doubleJumpUnlocked=!1,this.standing=!1,this.jumping=!1,Phaser.Sprite.call(this,this.game,e,a,"shapes",0),this.game.add.existing(this),this.game.physics.arcade.enable(this),this.anchor.setTo(.5,.5),this.body.collideWorldBounds=!0,this.body.gravity.y=750,this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN])};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.leftInputIsActive=function(){var t=!1;return t=this.game.input.keyboard.isDown(Phaser.Keyboard.A),t|=this.game.input.keyboard.isDown(Phaser.Keyboard.LEFT)},Player.prototype.rightInputIsActive=function(){var t=!1;return t=this.game.input.keyboard.isDown(Phaser.Keyboard.D),t|=this.game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)},Player.prototype.upInputIsActive=function(t){var e=!1;return e=this.game.input.keyboard.downDuration(Phaser.Keyboard.W,t),e|=this.game.input.keyboard.downDuration(Phaser.Keyboard.UP,t)},Player.prototype.upInputRelease=function(){var t=!1;return t=this.game.input.keyboard.upDuration(Phaser.Keyboard.W),t|=this.game.input.keyboard.upDuration(Phaser.Keyboard.UP)},Player.prototype.downInputIsActive=function(){var t=!1;return t=this.game.input.keyboard.isDown(Phaser.Keyboard.S),t|=this.game.input.keyboard.isDown(Phaser.Keyboard.DOWN)},Player.prototype.movements=function(){this.standing=this.body.blocked.down||this.body.touching.down,this.touchingLeft=this.body.blocked.left||this.body.touching.left,this.touchingRight=this.body.blocked.right||this.body.touching.right,this.standing?(this.frame=0,this.doubleJumpUnlocked===!0?this.jumps=2:this.jumps=1,this.jumping=!1):this.doubleJumpUnlocked===!0?1===this.jumps?this.frame=4:this.frame=1:this.triangleUnlocked===!0&&(this.frame=1),this.leftInputIsActive()?(this.facing=1,this.standing&&(this.frame=0),this.body.velocity.x=-this.MOVE_SPEED):this.rightInputIsActive()?(this.facing=-1,this.standing&&(this.frame=0),this.body.velocity.x=this.MOVE_SPEED):this.body.velocity.x=0,this.downInputIsActive()&&this.circleUnlocked===!0?(this.frame=2,this.body.setSize(30,30)):this.body.setSize(48,48),this.bowtieUnlocked&&(this.touchingLeft&&!this.standing?(this.sliding=!0,this.frame=3):this.touchingRight&&!this.standing?(this.sliding=!0,this.frame=3):this.sliding=!1),this.jumps>0&&this.upInputIsActive(5)&&this.triangleUnlocked&&(this.jumpSnd.play(),this.body.velocity.y=this.JUMP_SPEED,this.jumping=!0),this.sliding&&this.upInputIsActive(5)&&this.bowtieUnlocked&&(this.jumps++,this.game.add.tween(this).to({x:this.x+50*this.facing},100,Phaser.Easing.Linear.Out,!0,0),this.body.velocity.y=this.JUMP_SPEED,this.jumping=!0),this.jumping&&this.upInputRelease()&&(this.jumps--,this.jumping=!1)},Player.prototype.updateCamera=function(){if(!this.tweening){var t=32;this.tweening=!0;var e=700,a=!1;if(this.y>this.game.camera.y+Game.h-t?(Game.camera.y+=1,a=!0):this.y<this.game.camera.y?(Game.camera.y-=1,a=!0):this.x>this.game.camera.x+Game.w-t?(Game.camera.x+=1,a=!0):this.x<this.game.camera.x&&(Game.camera.x-=1,a=!0),a){var i=this.game.add.tween(this.game.camera).to({x:Game.camera.x*Game.w,y:Game.camera.y*Game.h},e);i.start(),i.onComplete.add(function(){this.tweening=!1},this)}else this.tweening=!1}},Player.prototype.constructor=Player,Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){this.game.stage.backgroundColor="#192331",this.titleText=this.game.add.bitmapText(Game.w/2,Game.h/2-100,"minecraftia","Geo Shift",42),this.titleText.anchor.setTo(.5),this.titleText.tint=16776960,this.game.add.tween(this.titleText).to({y:100},2e3,Phaser.Easing.Linear.In,!0,0,-1).yoyo(!0);var t=this.game.add.bitmapText(Game.w/2,Game.h-200,"minecraftia","Controls:\nWASD/Arrows\nUnlock abilities by collecting shapes:\nRed Triangle: Jump (up)\nGreen Bowtie: Wall Jump(up when touching a wall)\nCircle: Shrink (down)\nBlue Triangle: Double Jump (up x2)",18);t.anchor.setTo(.5);this.game.add.bitmapText(Game.w/2,Game.h/2-50,"minecraftia","~click to start~",24).anchor.setTo(.5)},update:function(){this.game.input.activePointer.isDown&&this.game.state.start("Play")}};var wKey,aKey,sKey,dKey,score=0;Game.Play=function(t){this.game=t},Game.Play.prototype={init:function(){this.game.physics.startSystem(Phaser.Physics.ARCADE)},create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.game.stage.backgroundColor="#000",this.elevators=this.game.add.physicsGroup(),this.elevators.setAll("body.allowGravity",!1),this.platforms=this.game.add.physicsGroup(),this.platforms.setAll("body.allowGravity",!1),this.powerups=this.game.add.physicsGroup(),this.powerups.setAll("body.immovalbe",!0),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.map=this.game.add.tilemap("world"),this.map.addTilesetImage("tiles","tiles"),this.map.setCollision(1),this.map.setCollision(2),this.map.setTileIndexCallback(3,this.playerDead,this),this.map.createFromObjects("objects",4,this.makeBox(160,32,"#00ff00"),0,!0,!1,this.elevators),this.map.createFromObjects("objects",5,this.makeBox(160,32,"#00ffff"),0,!0,!1,this.platforms),this.map.createFromObjects("objects",7,"shapes",0,!0,!1,this.powerups),this.layer=this.map.createLayer("layer1"),this.layer.resizeWorld(),this.loadObjects(),this.player=new Player(this.game,2e3,1216),this.music=this.game.add.sound("music"),this.music.volume=.3,this.music.loop=!0,this.music.play(),this.game.camera.x=Game.camera.x*Game.w,this.game.camera.y=Game.camera.y*Game.h,this.twitterButton=this.game.add.button(this.game.world.centerX,this.game.world.centerY+200,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.visible=!1},playerDead:function(){this.player.reset(Game.respawn.x,Game.respawn.y)},loadObjects:function(){this.elevators.forEach(function(t){if(t.anchor.set(.4,0),t.body.immovable=!0,void 0!==t.distance){var e=this.game.add.tween(t).to({y:(32*t.distance*t.direction*-1).toString()},300*t.distance).to({y:(32*t.distance*t.direction).toString()},300*t.distance);e.loop(!0).start()}},this),this.platforms.forEach(function(t){if(t.anchor.set(.4,0),t.body.immovable=!0,void 0!==t.distance){var e=this.game.add.tween(t).to({x:(32*t.distance*t.direction).toString()},300*t.distance).to({x:(32*t.distance*t.direction*-1).toString()},300*t.distance);e.loop(!0).start()}},this),this.powerups.forEach(function(t){t.frame=parseInt(t.index),t.anchor.setTo(.5),t.y+=t.height/2;var e=this.game.add.tween(t).to({y:"-5"},400).to({y:"+5"},400);e.loop(!0).start()},this)},update:function(){this.game.physics.arcade.collide(this.player,this.layer),this.game.physics.arcade.collide(this.player,this.elevators),this.game.physics.arcade.collide(this.player,this.platforms),this.game.physics.arcade.overlap(this.player,this.powerups,this.pickupPowerup,null,this),this.player.movements(),this.player.updateCamera()},pickupPowerup:function(t,e){Game.respawn.x=e.x,Game.respawn.y=e.y,1===e.frame?(t.triangleUnlocked=!0,e.kill()):3===e.frame?(t.bowtieUnlocked=!0,e.kill()):2===e.frame?(t.circleUnlocked=!0,e.kill()):4===e.frame&&(t.doubleJumpUnlocked=!0,e.kill())},makeBox:function(t,e,a){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle=a,i.ctx.fill(),i},twitter:function(){var t="http://www.divideby5.com/games/GAMETITLE/",e="rantt_",a=["LDJAM"];window.open("http://twitter.com/share?text=My+best+score+is+"+score+"+playing+GAME+TITLE+See+if+you+can+beat+it.+at&via="+e+"&url="+t+"&hashtags="+a.join(","),"_blank")}};var game=new Phaser.Game(Game.w,Game.h,Phaser.AUTO,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Play",Game.Play),game.state.start("Boot");