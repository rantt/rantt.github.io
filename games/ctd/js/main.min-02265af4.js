var Game={w:800,h:600};Game.Boot=function(t){this.game=t},null===localStorage.getItem("dotsHighestScore")&&localStorage.setItem("dotsHighestScore",0),Game.Boot.prototype={preload:function(){this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml"),this.game.load.bitmapFont("arcade","assets/fonts/arcade.png","assets/fonts/arcade.xml"),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.maxHeight=window.innerHeight,this.game.scale.maxWidth=window.innerHeight*(Game.w/Game.h),this.game.stage.scale.pageAlignHorizontally=!0,this.game.stage.scale.pageAlignVeritcally=!0,this.game.scale.setScreenSize(!0),this.game.load.image("twitter","assets/images/twitter.png"),this.game.load.image("clickHere","assets/images/clickhere.png")},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=this.game.plugins.add(Phaser.Plugin.ScreenShake);this.game.plugins.ScreenShake=t;var e=this.game.add.text(Game.w,Game.h,"Loading...",{font:"30px Helvetica",fill:"#000"});e.anchor.setTo(.5,.5);var s=this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading");this.game.load.setPreloadSprite(s)},create:function(){this.game.state.start("Menu")}},Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){this.game.physics.startSystem(Phaser.ARCADE),this.game.world.setBounds(0,0,800,600),this.game.stage.backgroundColor="#000",this.game.load.audio("con1","assets/audio/con1.wav"),this.colors=[16711680,255,16776960,65535,65280];var t=42;this.circlebmd=this.game.add.bitmapData(t,t),this.circlebmd.circle(t/2,t/2,t/2,"#FFFFFF"),this.stars=this.game.add.group(),this.stars.enableBody=!0,this.stars.physicsBodyType=Phaser.Physics.ARCADE,this.stars.setAll("checkWorldBounds",!0),this.stars.setAll("outOfBoundsKill",!0);for(var e=0;512>e;e++)this.starFieldSetup();this.connectText=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY-200,"arcade","Connect",64),this.connectText.align="center",this.connectText.updateText(),this.connectText.x=this.game.world.centerX-.5*this.connectText.textWidth,this.connectText.tint=16711680,this.theText=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY-100,"arcade","The",64),this.theText.align="center",this.theText.updateText(),this.theText.x=this.game.world.centerX-.5*this.theText.textWidth,this.theText.tint=65535,this.dotsText=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY,"arcade","Dots",64),this.dotsText.align="center",this.dotsText.updateText(),this.dotsText.x=this.game.world.centerX-.5*this.dotsText.textWidth,this.dotsText.tint=16776960,this.instructions=this.game.add.sprite(Game.w/2+200,200,"instructions"),this.instructions.scale.x=.5,this.instructions.scale.y=.5,this.startText=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY+100,"arcade","-click to start-",64),this.startText.align="center",this.startText.updateText(),this.startText.x=this.game.world.centerX-.5*this.startText.textWidth,this.startText.tint=65280},starFieldSetup:function(){var t=this.game.rnd.between(0,800),e=this.game.rnd.between(0,600),s=(this.game.rnd.between(1,5)/10,this.stars.getFirstExists(!1));null===s?(s=this.stars.create(t,e,this.circlebmd),s.z=0):(t=t,e=e,s.reset(t,e),s.z=0),s.scale.x=s.z/800,s.scale.y=s.z/800,s.tint=this.colors[this.game.rnd.between(0,4)],s.checkWorldBounds=!0,s.outOfBoundsKill=!0,s.rotation=this.game.physics.arcade.angleToXY(s,this.game.world.centerX,this.game.world.centerY)},update:function(){this.game.input.activePointer.isDown&&(this.game.sound.play("con1"),this.game.state.start("Play")),this.stars.forEach(function(t){if(t.alive){t.z+=1,t.scale.x=t.z/800,t.scale.y=t.z/800;var e=this.game.rnd.between(-100,-200);this.game.physics.arcade.velocityFromRotation(t.rotation,e,t.body.velocity)}else this.starFieldSetup()},this)}};var wKey,aKey,sKey,dKey;Game.Play=function(t){this.game=t},Game.Play.prototype={preload:function(){this.dots=new Dots(this.game),this.dots.preload()},create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.game.stage.backgroundColor="#000000",this.highestScore=JSON.parse(localStorage.getItem("dotsHighestScore")),this.game.add.sprite(0,0,this.circlebmd),wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),this.dots.create(),this.dots.initialBoard(),this.moveText=this.game.add.bitmapText(Game.w-120,16,"minecraftia","0/"+this.dots.moveLimit,32),this.scoreText=this.game.add.bitmapText(20,16,"minecraftia","Score: "+this.dots.score,32)},update:function(){this.scoreText.setText("Score: "+this.dots.score),this.moveText.setText(this.dots.moveCount+"/"+this.dots.moveLimit),this.game.stage.backgroundColor=1==this.dots.looped?"#FFFFFF":"#000000",this.dots.moveCount===this.dots.moveLimit&&(Game.score=this.dots.score,this.dots.score>this.highestScore&&localStorage.setItem("dotsHighestScore",this.dots.score),this.game.state.start("Outro"))}};var Dots=function(t){this.game=t,this.boardWidth=8,this.boardHeight=8,this.board=[],this.idCount=0,this.selected=null,this.scoreList=[],this.score=0,this.moveCount=0,this.moveLimit=20};Dots.prototype={preload:function(){var t=32;this.circlebmd=this.game.add.bitmapData(t,t),this.circlebmd.circle(t/2,t/2,t/2,"#FFFFFF"),this.debris=this.game.add.bitmapData(8,8),this.debris.circle(4,4,4,"#FFFFFF"),this.linebmd=this.game.add.bitmapData(800,600),this.linebmd.ctx.lineWidth="4",this.linebmd.ctx.strokeColor="#000000",this.linebmd.ctx.stroke(),this.emitter=this.game.add.emitter(0,0,100),this.emitter.makeParticles(this.debris),this.emitter.gravity=500,this.emitter.minParticleSpeed.setTo(-200,-200),this.emitter.maxParticleSpeed.setTo(200,200),this.game.load.audio("con1","assets/audio/con1.wav"),this.game.load.audio("con2","assets/audio/con2.wav"),this.game.load.audio("con3","assets/audio/con3.wav"),this.game.load.audio("con4","assets/audio/con4.wav"),this.game.load.audio("con5","assets/audio/con5.wav"),this.game.load.audio("con6","assets/audio/con6.wav"),this.game.load.audio("con7","assets/audio/con7.wav"),this.game.load.audio("boom","assets/audio/boom.wav")},create:function(){this.dots=this.game.add.group(),this.dots.createMultiple(64,this.circlebmd),this.dots.setAll("anchor.x",.5),this.dots.setAll("anchor.y",.5),this.guideLine=this.game.add.sprite(0,0,this.linebmd),this.colors=[16711680,255,16776960,65535,65280]},initialBoard:function(){this.board=[];for(var t=0;t<this.boardWidth;t++){for(var e=[],s=0;s<this.boardHeight;s++){var i=this.addDot();e.push(i)}this.board.push(e)}return this.drawBoard(),this.board},clickDot:function(t){this.selected=t,this.scoreList.push(t)},overDot:function(t){if(null!==this.selected&&this.isAdjacent(this.selected,t)){this.game.sound.play(this.scoreList.length<7?"con"+this.scoreList.length:"con7"),this.scoreList[this.scoreList.length-2]===t?(this.scoreList.pop(),this.selected=t,this.looped=!1):this.scoreList.indexOf(t)>-1&&this.scoreList.length>3?this.looped=!0:this.selected.tint===t.tint&&(this.looped=!1,this.selected=t,-1===this.scoreList.indexOf(t)&&this.scoreList.push(t)),this.linebmd.clear(),this.linebmd.ctx.beginPath(),this.linebmd.ctx.strokeStyle="#"+("00000"+this.selected.tint.toString(16)).substr(-6),this.linebmd.ctx.moveTo(this.scoreList[0].x,this.scoreList[0].y);for(var e=0;e<this.scoreList.length-1;e++){var s=this.scoreList[e+1];this.linebmd.ctx.lineTo(s.x,s.y)}this.looped===!0&&this.linebmd.ctx.lineTo(t.x,t.y),this.linebmd.ctx.lineWidth=4,this.linebmd.ctx.stroke(),this.linebmd.ctx.closePath()}},upDot:function(){this.linebmd.clear(),this.looped===!0&&this.looper(),this.score+=this.scorePoints(),this.scoreList=[],this.selected=null,this.drawBoard()},looper:function(){for(var t=0;t<this.boardWidth;t++)for(var e=0;e<this.boardHeight;e++){var s=this.board[t][e];this.selected.tint===s.tint&&this.scoreList.push(s)}},scorePoints:function(){if(1===this.scoreList.length)return 0;var t=[];this.scoreList.forEach(function(e){t.push(e._id)},this);for(var e=0;e<this.boardWidth;e++)for(var s=0;s<this.boardHeight;s++){var i=this.board[e][s];t.indexOf(i._id)>-1&&(this.looped===!0&&(this.game.plugins.ScreenShake.start(10),this.game.sound.play("boom")),i.kill(),this.board[e].splice(s,1),this.board[e].push(this.addDot()),s--)}return this.looped=!1,this.moveCount+=1,this.scoreList.length},addDot:function(){var t=this.game.rnd.between(0,4),e=this.dots.getFirstDead();return e._id=this.idCount,e.spriteNum=t,e.tint=this.colors[t],e.inputEnabled=!0,e.events.onInputDown.add(this.clickDot,this),e.events.onInputUp.add(this.upDot,this),e.events.onInputOver.add(this.overDot,this),e.reset(this.game.world.centerX,-this.game.world.centerY),this.idCount++,e},drawBoard:function(){for(var t=0;t<this.boardWidth;t++)for(var e=0;e<this.boardHeight;e++){var s=64*t+160,i=550-64*e,a=this.board[t][e];if(a.scale.x=1,a.scale.y=1,a.x!==s||a.y!==i){this.game.add.tween(a).to({x:s,y:i},300).start()}}},getPosition:function(t){for(var e=0;e<this.boardWidth;e++){var s=this.board[e].indexOf(t);if(s>-1)return{i:e,j:s}}return{}},isAdjacent:function(t,e){var s=this.getPosition(t),i=this.getPosition(e);return(i.i!==s.i||i.j!==s.j-1&&i.j!==s.j+1)&&(i.j!==s.j||i.i!==s.i-1&&i.i!==s.i+1)?!1:!0}},Game.Outro=function(t){this.game=t},Game.Outro.prototype={create:function(){this.game.physics.startSystem(Phaser.ARCADE),this.highestScore=JSON.parse(localStorage.getItem("dotsHighestScore")),this.game.world.setBounds(0,0,800,600),this.game.stage.backgroundColor="#000";var t=42;this.circlebmd=this.game.add.bitmapData(t,t),this.circlebmd.circle(t/2,t/2,t/2,"#FFFFFF"),this.colors=[16711680,255,16776960,65535,65280],wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),this.MAX_DEPTH=800,this.stars=this.game.add.group(),this.stars.enableBody=!0,this.stars.physicsBodyType=Phaser.Physics.ARCADE,this.stars.setAll("checkWorldBounds",!0),this.stars.setAll("outOfBoundsKill",!0);for(var e=0;512>e;e++)this.starFieldSetup();this.movesText=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY-200,"minecraftia","In Twenty Moves...",32),this.movesText.align="center",this.movesText.updateText(),this.movesText.x=this.game.world.centerX-.5*this.movesText.textWidth,this.scoreText=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY-100,"minecraftia","Your Score: "+Game.score,32),this.scoreText.align="center",this.scoreText.updateText(),this.scoreText.x=this.game.world.centerX-.5*this.scoreText.textWidth,this.highText=this.game.add.bitmapText(this.game.world.centerX,this.game.world.centerY,"minecraftia","Your Highest Score: "+this.highestScore,32),this.highText.align="center",this.highText.updateText(),this.highText.x=this.game.world.centerX-.5*this.highText.textWidth,this.twitterButton=this.game.add.button(this.game.world.centerX,this.game.world.centerY+100,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.fixedToCamera=!0,this.clickHereButton=this.game.add.button(this.game.world.centerX,this.game.world.centerY+200,"clickHere",function(){this.game.state.start("Play")},this),this.clickHereButton.anchor.set(.5),this.clickHereButton.fixedToCamera=!0},starFieldSetup:function(){var t=this.game.rnd.between(0,800),e=this.game.rnd.between(0,600),s=(this.game.rnd.between(1,5)/10,this.stars.getFirstExists(!1));null===s?(s=this.stars.create(t,e,this.circlebmd),s.z=0):(t=t,e=e,s.reset(t,e),s.z=0),s.scale.x=s.z/800,s.scale.y=s.z/800,s.tint=this.colors[this.game.rnd.between(0,4)],s.checkWorldBounds=!0,s.outOfBoundsKill=!0,s.rotation=this.game.physics.arcade.angleToXY(s,this.game.world.centerX,this.game.world.centerY)},twitter:function(){window.open("http://twitter.com/share?text=My+best+score+is+"+this.highestScore+"+playing+Connect+The+Dots+See+if+you+can+beat+it.+at&via=rantt_&url=http://www.divideby5.com/games/ctd/&hashtags=ConnectTheDots,1GAM","_blank")},update:function(){this.stars.forEach(function(t){if(t.alive){t.z+=1,t.scale.x=t.z/800,t.scale.y=t.z/800;var e=this.game.rnd.between(-100,-200);this.game.physics.arcade.velocityFromRotation(t.rotation,e,t.body.velocity)}else this.starFieldSetup()},this)}},Phaser.Plugin.ScreenShake=function(t,e){Phaser.Plugin.call(this,t,e),this.shakeWorld=0},Phaser.Plugin.ScreenShake.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.ScreenShake.prototype.constructor=Phaser.Plugin.ScreenShake,Phaser.Plugin.ScreenShake.prototype.start=function(t,e,s){this.x="undefined"!=typeof e?e:20,this.y="undefined"!=typeof s?s:20,this.shakeWorld=t,console.log(this.shakeWorld)},Phaser.Plugin.ScreenShake.prototype.postUpdate=function(){if(this.shakeWorld>0){var t=this.game.rnd.integerInRange(-this.x,this.x),e=this.game.rnd.integerInRange(-this.y,this.y);this.game.world.setBounds(t,e,this.game.width+t,this.game.height+e),this.shakeWorld--,0==this.shakeWorld&&this.game.world.setBounds(0,0,this.game.width,this.game.height)}};var game=new Phaser.Game(Game.w,Game.h,Phaser.AUTO,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Outro",Game.Outro),game.state.add("Play",Game.Play),game.state.start("Boot");