var Player=function(t,e,a,i){this.game=t,Phaser.Sprite.call(this,t,e*tileSize,a*tileSize,"player"),this.map=i,this.marker=new Phaser.Point(e,a),this.cursor=this.game.input.keyboard.createCursorKeys(),wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),this.game.physics.arcade.enable(this),this.body.fixedRotation=!0,this.body.moves=!1,this.game.add.existing(this),this.direction="down",this.animations.add("down",[6,7],6,!0),this.animations.add("up",[8,9],6,!0),this.animations.add("right",[4,11],6,!0),this.animations.add("left",[5,10],6,!0)};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.update=function(){this.isMoving?this.movementTimer=this.game.time.now+2e3:this.game.time.now>this.movementTimer,this.movements(),this.updatecamera()},Player.prototype.movements=function(){this.tweening||(this.cursor.left.isDown||aKey.isDown||leftArrow?(this.moveTo(-1,0),this.direction="left",this.animations.play("left")):this.cursor.right.isDown||dKey.isDown||rightArrow?(this.moveTo(1,0),this.direction="right",this.animations.play("right")):this.cursor.up.isDown||wKey.isDown||upArrow?(this.moveTo(0,-1),this.direction="up",this.animations.play("up")):this.cursor.down.isDown||sKey.isDown||downArrow?(this.moveTo(0,1),this.direction="down",this.animations.play("down")):("up"===this.direction?this.frame=1:"down"===this.direction?this.frame=0:"right"===this.direction?this.frame=2:"left"===this.direction&&(this.frame=3),this.animations.stop()))},Player.prototype.moveTo=function(t,e){this.isMoving||this.cantMove(t,e)||(this.isMoving=!0,this.game.add.tween(this).to({x:this.x+64*t,y:this.y+64*e},120,Phaser.Easing.Linear.None,!0).onComplete.add(function(){this.marker.x+=t,this.marker.y+=e,this.isMoving=!1},this))},Player.prototype.cantMove=function(t,e){if(this.inCombat)return!0;var a=this.marker.x+t,i=this.marker.y+e,s=this.map.getTile(a,i,"layer1");return null===s||(!!this.map.getTile(a,i,"layer1").collideDown||null!==this.map.getTile(a,i,"layer2")&&this.map.getTile(a,i,"layer2").collideDown)},Player.prototype.updatecamera=function(){if(!this.tweening){this.tweening=!0;var t=700,e=!1;if(this.y>this.game.camera.y+Game.h-64?(Game.camera.y+=1,e=!0):this.y<this.game.camera.y?(Game.camera.y-=1,e=!0):this.x>this.game.camera.x+Game.w-64?(Game.camera.x+=1,e=!0):this.x<this.game.camera.x&&(Game.camera.x-=1,e=!0),e){var a=this.game.add.tween(this.game.camera).to({x:Game.camera.x*Game.w,y:Game.camera.y*Game.h},t);a.start(),a.onComplete.add(function(){this.tweening=!1},this)}else this.tweening=!1}},Player.prototype.constructor=Player;var tileSize=64,dRows=10,dCols=12,dialogue,spaceKey,Game={w:tileSize*dCols,h:tileSize*dRows,camera:{x:0,y:0}};Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.stage.backgroundColor="#FFF",this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml"),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.maxHeight=window.innerHeight,this.game.scale.maxWidth=window.innerHeight*(Game.w/Game.h)},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=(this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","Loading...",30).anchor.setTo(.5),this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading"));this.game.load.setPreloadSprite(t),this.game.load.spritesheet("player","assets/images/hero_x64.png",64,64,12),this.game.load.spritesheet("box","assets/images/box_tiles.png",64,64,3),this.game.load.spritesheet("tiles","assets/images/tiles2.png",tileSize,tileSize,19),this.game.load.tilemap("test","assets/atlas/test.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.tilemap("test2","assets/atlas/test2.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.image("twitter","assets/images/twitter.png")},create:function(){this.game.state.start("Menu")}},Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){this.title=this.game.add.sprite(Game.w/2,Game.h/2-100,"title"),this.title.anchor.setTo(.5,.5),this.instructions=this.game.add.sprite(Game.w/2+200,200,"instructions"),this.instructions.scale.x=.5,this.instructions.scale.y=.5;this.game.add.bitmapText(Game.w/2,Game.h/2+50,"minecraftia","~click to start~",24).anchor.setTo(.5)},update:function(){this.game.input.activePointer.isDown&&this.game.state.start("Play")}};var wKey,aKey,sKey,dKey,leftArrow,rightArrow,upArrow,downArrow,score=0;Game.Play=function(t){this.game=t},Game.Play.prototype={create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.map=this.game.add.tilemap("test2"),this.map.addTilesetImage("tiles"),this.layer1=this.map.createLayer("layer1"),this.layer2=this.map.createLayer("layer2"),this.map.setCollision([1,7,8,9,10,11]),this.map.setCollision([1,7,8,9,10,11,14,15,16,17],!0,"layer2"),this.layer1.resizeWorld(),this.layer2.resizeWorld();this.map.getTile(0,0,"layer1");this.player=new Player(this.game,5,5,this.map),this.signs=this.game.add.group(),this.map.createFromObjects("objects",19,"tiles",18,!0,!1,this.signs),this.sign_text=this.game.add.bitmapText(32,480,"minecraftia","",24),this.sign_text.fixedToCamera=!0,wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),this.twitterButton=this.game.add.button(45*tileSize,31*tileSize,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.visible=!0},update:function(){function t(t,e){var a=t.getBounds(),i=e.getBounds();return Phaser.Rectangle.intersects(a,i)}this.signs.forEach(function(e){t(this.player,e)&&(this.lastRead=this.game.time.now+500,this.sign_text.setText(e.text))},this),this.game.time.now>this.lastRead&&this.sign_text.setText("")},twitter:function(){var t="http://www.divideby5.com/games/making_friends/",e="rantt_",a=["1GAM"];window.open("http://twitter.com/share?text=Making+Friends+Is+Easy.+at&via="+e+"&url="+t+"&hashtags="+a.join(","),"_blank")}};var game=new Phaser.Game(Game.w,Game.h,Phaser.CANVAS,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Play",Game.Play),game.state.start("Boot");