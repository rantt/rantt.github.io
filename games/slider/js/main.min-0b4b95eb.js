function rand(t,e){return Math.floor(Math.random()*(e-t+1))+t}var Game={w:1024,h:768};Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.stage.backgroundColor="#FFF",this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml"),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.maxHeight=window.innerHeight,this.game.scale.maxWidth=window.innerHeight*(Game.w/Game.h)},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=this.game.add.text(Game.w,Game.h,"Loading...",{font:"30px Helvetica",fill:"#000"});t.anchor.setTo(.5,.5);var e=this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading");this.game.load.setPreloadSprite(e),this.game.load.image("twitter","assets/images/twitter.png"),this.game.load.image("easy","assets/images/easy.png"),this.game.load.image("normal","assets/images/normal.png"),this.game.load.image("hard","assets/images/hard.png"),this.game.load.atlasXML("startbtn","assets/images/startbtn.png","assets/atlas/startbtn.xml");for(var i=1;5>i;i++)this.game.load.image(i.toString(),"assets/images/"+i.toString()+".png")},create:function(){this.game.state.start("Menu")}};var level=1;Game.Gallery=function(t){this.game=t},Game.Gallery.prototype={create:function(){this.game.stage.backgroundColor="#dcdcdc",this.menu_button=this.game.add.button(0,0,this.makeBox(200,50),this.gotoMenu,this),this.menu_button.tint=16711935,this.game.add.bitmapText(50,10,"minecraftia","Menu",24),this.game.add.bitmapText(Game.w/2,40,"minecraftia",difficulty,36).anchor.setTo(.5),x=220,y=160,count=0;for(var t=1;5>t;t++){count+=1;var e=this.game.add.button(x,y,t.toString(),this.loadLevel,this);e.anchor.setTo(.5),e.scale.x=.3,e.scale.y=.3,x+=300,3===count&&(count=0,y+=220,x=220)}},gotoMenu:function(){this.game.state.start("Menu")},makeBox:function(t,e){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle="#fff",i.ctx.fill(),i},loadLevel:function(){level=arguments[0].key,this.game.state.start("Play")}};var Puzzle=function(t,e,i){this.game=t,this.pic=e,this.square=i,this.solved=!1,this.scrambled=!1,this.scrambling=!1,this.tileSpeed=500,this.scrambleSpeed=5;var a=this.game.add.image(0,0,e);a.visible=!1;var s=a.width,h=a.height;this.offsetX=(Game.w-s)/2,this.offsetY=(Game.h-h)/2,this.tile_width=Math.floor(s/this.square),this.tile_height=Math.floor(h/this.square),this.pieces=[],this.background=[],this.piece_list={};for(var o=0;o<this.square;o++)for(var n=0;n<this.square;n++)this.background.push(this.makeBox(this.offsetX+n*this.tile_width,this.offsetY+o*this.tile_height,this.tile_width,this.tile_height));for(var o=0;o<this.square;o++)for(var n=0;n<this.square;n++)if(0!==o||0!==n){var r=new PuzzlePiece(this.game,this.offsetX+n*this.tile_width,this.offsetY+o*this.tile_height,n,o,this.tile_width,this.tile_height,e);r.events.onInputUp.add(this.movePiece,this),this.piece_list[n+"_"+o]=r,this.pieces.push(r)}};Puzzle.prototype=Puzzle.prototype.constructor=Puzzle,Puzzle.prototype={destroy:function(){this.pieces.forEach(function(t){void 0!=t&&t.destroy()},this),this.background.forEach(function(t){t.destroy()},this)},makeBox:function(t,e,i,a){var s=this.game.add.graphics(i,a);return s.beginFill(16777215),s.lineStyle(2,16711935,1),s.drawRect(t-i,e-a,i,a),s},scramble:function(t,e,i){if(0==t)return this.speed=this.tileSpeed,this.tweening=!1,void(this.scrambled=!0);this.scrambling=!0,this.speed=this.scrambleSpeed;var a,e=e||{i:0,j:0},s=["up","down","left","right"];void 0!==i&&("up"===i&&s.indexOf("down"),"down"===i&&s.indexOf("up"),"right"===i&&s.indexOf("left"),"left"===i&&s.indexOf("right"));var h=Math.floor(Math.random()*s.length),o=s[h];"up"==o?a=this.piece_list[e.j+"_"+(e.i-1)]:"down"==o?a=this.piece_list[e.j+"_"+(e.i+1)]:"left"==o?a=this.piece_list[e.j-1+"_"+e.i]:"right"==o&&(a=this.piece_list[e.j+1+"_"+e.i]),void 0!==a?(e.i=a.i,e.j=a.j,this.game.time.events.add(Phaser.Timer.SECOND*this.scrambleSpeed/100,function(){this.movePiece(a),t--,this.scramble(t,e,o)},this)):this.scramble(t,e,o)},movePiece:function(t){if(!this.solved){if(void 0===this.piece_list[t.j-1+"_"+t.i]&&t.j-1>=0){this.piece_list[t.j+"_"+t.i]=void 0,t.j-=1,this.piece_list[t.j+"_"+t.i]=t;var e=this.offsetX+t.j*t.width;this.game.add.tween(t).to({x:e},this.speed).start()}else if(void 0===this.piece_list[t.j+1+"_"+t.i]&&t.j+1<this.square){this.piece_list[t.j+"_"+t.i]=void 0,t.j+=1,this.piece_list[t.j+"_"+t.i]=t;var e=this.offsetX+t.j*t.width;this.game.add.tween(t).to({x:e},this.speed).start()}else if(void 0===this.piece_list[t.j+"_"+(t.i-1)]&&t.i-1>=0){this.piece_list[t.j+"_"+t.i]=void 0,t.i-=1,this.piece_list[t.j+"_"+t.i]=t;var e=this.offsetY+t.i*t.height;this.game.add.tween(t).to({y:e},this.speed).start()}else if(void 0===this.piece_list[t.j+"_"+(t.i+1)]&&t.i+1<this.square){this.piece_list[t.j+"_"+t.i]=void 0,t.i+=1,this.piece_list[t.j+"_"+t.i]=t;var e=this.offsetY+t.i*t.height;this.game.add.tween(t).to({y:e},this.speed).start()}this.checkWin()&&this.scrambled&&(this.game.time.events.add(.5*Phaser.Timer.SECOND,function(){var t=new PuzzlePiece(this.game,this.offsetX,this.offsetY,0,0,this.tile_width,this.tile_height,this.pic);this.pieces.push(t)},this),this.solved=!0)}},checkWin:function(){for(var t=0;t<this.pieces.length;t++)if(this.pieces[t].i!==this.pieces[t].initialI||this.pieces[t].j!==this.pieces[t].initialJ)return!1;return!0}};var PuzzlePiece=function(t,e,i,a,s,h,o,n){this.game=t;var r=this.game.make.bitmapData(h,o);area=new Phaser.Rectangle(a*h,s*o,h,o),r.copyRect(n,area,0,0),r.update();var l=t.add.sprite(e,i,r);return l.inputEnabled=!0,l.i=s,l.j=a,l.initialJ=a,l.initialI=s,l};PuzzlePiece.prototype.constructor=PuzzlePiece;var difficulty="normal";Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){this.game.stage.backgroundColor="#2d2d2d",this.titleText=this.game.add.bitmapText(Game.w/2,Game.h/2-100,"minecraftia","Slider",64),this.titleText.anchor.setTo(.5),this.titleText.tint=16711935,this.difficultyButtons=this.game.add.group(),this.easyButton=this.game.add.button(Game.w/2,Game.h/2+75,"easy",this.difficultySelect,this),this.easyButton.anchor.setTo(.5),this.difficultyButtons.add(this.easyButton),this.normalButton=this.game.add.button(Game.w/2,Game.h/2+110,"normal",this.difficultySelect,this),this.normalButton.anchor.setTo(.5),this.normalButton.tint=16711935,this.difficultyButtons.add(this.normalButton),this.hardButton=this.game.add.button(Game.w/2,Game.h/2+155,"hard",this.difficultySelect,this),this.hardButton.anchor.setTo(.5),this.difficultyButtons.add(this.hardButton),this.startButton=this.game.add.button(Game.w/2,Game.h/2+220,"startbtn",this.begin,this,1),this.startButton.anchor.setTo(.5)},begin:function(){this.game.state.start("Gallery")},difficultySelect:function(t){this.difficultyButtons.forEach(function(t){t.tint=16777215}),t.tint=16711935,difficulty=t.key},makeButton:function(t,e,i){var a=this.game.add.bitmapData(t,e);return a.ctx.beginPath(),a.ctx.rect(0,0,t,e),a.ctx.fillStyle="#000",a.ctx.fill(),a}},Game.Play=function(t){this.game=t},Game.Play.prototype={create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.menu_button=this.game.add.button(0,0,this.makeBox(200,50),this.gotoMenu,this),this.menu_button.tint=16711935,this.game.add.bitmapText(50,10,"minecraftia","Menu",24),this.game.stage.backgroundColor="#2d2d2d","easy"===difficulty?(this.square=3,this.moves=15):"normal"===difficulty?(this.square=4,this.moves=20):"hard"===difficulty&&(this.square=5,this.moves=30),this.puzzle=new Puzzle(this.game,level,this.square),this.playAgainText=this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","Click To Start",48),this.playAgainText.anchor.set(.5),this.playAgainText.tint=16711935,this.twitterButton=this.game.add.button(Game.w/2,Game.h-30,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.visible=!0},update:function(){this.puzzle.solved===!1?this.game.input.activePointer.isDown&&this.puzzle.scrambling===!1&&(this.playAgainText.setText(""),this.puzzle.scramble(this.moves)):(this.game.input.onUp.add(this.gotoMenu,this),this.playAgainText.setText("GREAT JOB!\nClick to Play Again."),this.game.world.bringToTop(this.playAgainText))},gotoMenu:function(){this.game.state.start("Gallery")},makeBox:function(t,e){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle="#fff",i.ctx.fill(),i},twitter:function(){var t="http://www.divideby5.com/games/slider/",e="rantt_",i=[""];window.open("http://twitter.com/share?text=Relax+with+a+fun+sliding+puzzle.+at&via="+e+"&url="+t+"&hashtags="+i.join(","),"_blank")}};var game=new Phaser.Game(Game.w,Game.h,Phaser.CANVAS,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Gallery",Game.Gallery),game.state.add("Play",Game.Play),game.state.start("Boot");