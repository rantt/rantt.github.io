function rand(t,e){return Math.floor(Math.random()*(e-t+1))+t}var Game={w:1024,h:768};Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.stage.backgroundColor="#FFF",this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml"),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.maxHeight=window.innerHeight,this.game.scale.maxWidth=window.innerHeight*(Game.w/Game.h)},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=(this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","Loading...",30).anchor.setTo(.5),this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading"));this.game.load.setPreloadSprite(t),this.game.load.image("twitter","assets/images/twitter.png"),this.game.load.image("easy","assets/images/easy.png"),this.game.load.image("normal","assets/images/normal.png"),this.game.load.image("hard","assets/images/hard.png"),this.game.load.atlasXML("startbtn","assets/images/startbtn.png","assets/atlas/startbtn.xml");for(var e=1;10>e;e++)this.game.load.image(e.toString(),"assets/images/"+e.toString()+".png")},create:function(){this.game.state.start("Menu")}};var level=1;Game.Gallery=function(t){this.game=t},Game.Gallery.prototype={create:function(){this.game.stage.backgroundColor="#dcdcdc",this.menu_button=this.game.add.button(0,0,this.makeBox(200,50),this.gotoMenu,this),this.menu_button.tint=16711935,this.game.add.bitmapText(50,10,"minecraftia","Menu",24),this.game.add.bitmapText(Game.w/2,40,"minecraftia",difficulty,36).anchor.setTo(.5),this.game.add.bitmapText(Game.w/2,Game.h-24,"minecraftia","Photos by ping_01 on Instagram",24).anchor.setTo(.5),x=220,y=160,count=0;for(var t=1;10>t;t++){count+=1;var e=this.game.add.button(x,y,t.toString(),this.loadLevel,this);e.anchor.setTo(.5),e.scale.x=.3,e.scale.y=.3,x+=300,3===count&&(count=0,y+=220,x=220)}},gotoMenu:function(){this.game.state.start("Menu")},makeBox:function(t,e){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle="#fff",i.ctx.fill(),i},loadLevel:function(){level=arguments[0].key,this.game.state.start("Play")}};var Puzzle=function(t,e,i){this.game=t,this.pic=e,this.square=i,this.won=!1,this.src_image=this.game.add.image(Game.w/2,Game.h/2,e),this.src_image.anchor.setTo(.5),this.src_image.visible=!1;var a=this.src_image.width,s=this.src_image.height;this.offsetX=(Game.w-a)/2,this.offsetY=(Game.h-s)/2,this.tile_width=Math.floor(a/this.square),this.tile_height=Math.floor(s/this.square),this.pieces=[],this.slots=[],this.background={},this.piece_list={};for(var o=0;o<this.square;o++)for(var h=0;h<this.square;h++){var n=this.game.add.sprite(this.offsetX+h*this.tile_width,this.offsetY+o*this.tile_height,this.makeBox(this.tile_width,this.tile_height));n.j=h,n.i=o,this.background[h+"_"+o]=n,this.slots.push(n)}for(var r=[-1,1],o=0;o<this.square;o++)for(var h=0;h<this.square;h++){var l={ls:0,bs:0,rs:0,ts:0};void 0!==this.piece_list[h+"_"+(o-1)]?l.ts=-1*this.piece_list[h+"_"+(o-1)].bottom_side:l.ts=r[rand(0,1)],void 0!==this.piece_list[h-1+"_"+o]?l.ls=-1*this.piece_list[h-1+"_"+o].right_side:l.ls=r[rand(0,1)],l.bs=r[rand(0,1)],l.rs=r[rand(0,1)],h===this.square-1&&(l.rs=0),0===o&&(l.ts=0),o===this.square-1&&(l.bs=0),0===h&&(l.ls=0);var c=new PuzzlePiece(this.game,this.offsetX+h*this.tile_width,this.offsetY+o*this.tile_height,h,o,this.tile_width,this.tile_height,e,l);c.events.onDragStart.add(this.onDragStart,this),c.events.onDragStop.add(this.onDragStop,this),this.pieces.push(c),this.piece_list[h+"_"+o]=c}};Puzzle.prototype=Puzzle.prototype.constructor=Puzzle,Puzzle.prototype={onDragStart:function(t,e){this.game.world.bringToTop(t)},onDragStop:function(t,e){var i=this.background[t.j+"_"+t.i];Phaser.Rectangle.intersects(t.getBounds(),i.getBounds())&&(this.game.world.sendToBack(t),i.visible=!1,t.inputEnabled=!1,t.input.enableDrag(!1),t.x=t.initialX,t.y=t.initialY,this.slots.forEach(function(t){this.game.world.sendToBack(t)},this),this.won=this.checkWin())},checkWin:function(){for(var t=!0,e=0;e<this.pieces.length;e++)this.pieces[e].x!==this.pieces[e].initialX&&this.pieces[e].y!==this.pieces[e].initialY&&(t=!1);return t},scatter:function(){for(var t=0;t<this.pieces.length;t++){var e=this.pieces[t];e.x=rand(0,Game.w-this.tile_width/2),e.y=rand(this.tile_height/2,Game.h-this.tile_height/2)}},destroy:function(){this.slots.forEach(function(t){t.destroy()},this),this.pieces.forEach(function(t){t.destroy()},this)},preview_toggle:function(){this.src_image.visible===!1?(this.src_image.visible=!0,this.game.world.bringToTop(this.src_image),this.pieces.forEach(function(t){t.visible=!1},this)):(this.src_image.visible=!1,this.pieces.forEach(function(t){t.visible=!0},this))},makeBox:function(t,e){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle="#202020",i.ctx.lineStyle=4,i.ctx.strokeStyle="#ff00ff",i.ctx.fill(),i}};var PuzzlePiece=function(t,e,i,a,s,o,h,n,r){this.game=t,this.left_side=r.ls,this.bottom_side=r.bs,this.right_side=r.rs,this.top_side=r.ts,this.i=s,this.j=a;var l=Math.floor(1.3*o),c=Math.floor(1.3*h),m={x:Math.floor(.15*o),y:Math.floor(.15*h)},d={x:o+Math.floor(.15*o),y:Math.floor(.15*h)},f={x:Math.floor(.15*o),y:h+Math.floor(.15*h)},g={x:o+Math.floor(.15*o),y:h+Math.floor(.15*h)};this.piecebmd=this.game.add.bitmapData(l,c),this.piecebmd.ctx.clearRect(0,0,l,c),this.piecebmd.ctx.strokeStyle="#FFF",this.piecebmd.ctx.fillStyle="#dcdcdc",this.piecebmd.ctx.lineWidth=2,this.piecebmd.ctx.fill(),this.piecebmd.ctx.beginPath(),0===this.left_side?(this.piecebmd.ctx.moveTo(m.x,m.y),this.piecebmd.ctx.lineTo(f.x,f.y)):-1===this.left_side?(this.piecebmd.ctx.moveTo(m.x,m.y),this.piecebmd.ctx.lineTo(m.x,Math.floor(m.y+h/3)),this.piecebmd.ctx.lineTo(Math.floor(m.x+.1*o),Math.floor(m.y+h/3)),this.piecebmd.ctx.lineTo(Math.floor(m.x+.15*o),Math.floor(m.y+h/3+h/6)),this.piecebmd.ctx.lineTo(Math.floor(m.x+.1*o),Math.floor(m.y+h/3+2*h/6)),this.piecebmd.ctx.lineTo(m.x,Math.floor(m.y+h/3+2*h/6)),this.piecebmd.ctx.lineTo(f.x,f.y)):1===this.left_side&&(this.piecebmd.ctx.moveTo(m.x,m.y),this.piecebmd.ctx.lineTo(m.x,Math.floor(m.y+h/3)),this.piecebmd.ctx.lineTo(Math.floor(m.x-.1*o),Math.floor(m.y+h/3)),this.piecebmd.ctx.lineTo(Math.floor(m.x-.15*o),Math.floor(m.y+h/3+h/6)),this.piecebmd.ctx.lineTo(Math.floor(m.x-.1*o),Math.floor(m.y+h/3+2*h/6)),this.piecebmd.ctx.lineTo(m.x,Math.floor(m.y+h/3+2*h/6)),this.piecebmd.ctx.lineTo(f.x,f.y)),0===this.bottom_side?this.piecebmd.ctx.lineTo(g.x,g.y):-1===this.bottom_side?(this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3),f.y),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3),Math.floor(f.y-.1*o)),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3+o/6),Math.floor(f.y-.15*o)),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3+2*o/6),Math.floor(f.y-.1*o)),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3+2*o/6),f.y),this.piecebmd.ctx.lineTo(g.x,f.y)):1===this.bottom_side&&(this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3),f.y),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3),Math.floor(f.y+.1*o)),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3+o/6),Math.floor(f.y+.15*o)),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3+2*o/6),Math.floor(f.y+.1*o)),this.piecebmd.ctx.lineTo(Math.floor(f.x+o/3+2*o/6),f.y),this.piecebmd.ctx.lineTo(g.x,g.y)),0===this.right_side?this.piecebmd.ctx.lineTo(d.x,d.y):-1===this.right_side?(this.piecebmd.ctx.lineTo(g.x,Math.floor(g.y-h/3)),this.piecebmd.ctx.lineTo(Math.floor(g.x-.1*o),Math.floor(g.y-h/3)),this.piecebmd.ctx.lineTo(Math.floor(g.x-.15*o),Math.floor(g.y-h/3-h/6)),this.piecebmd.ctx.lineTo(Math.floor(g.x-.1*o),Math.floor(g.y-h/3-2*h/6)),this.piecebmd.ctx.lineTo(g.x,Math.floor(g.y-h/3-2*h/6)),this.piecebmd.ctx.lineTo(d.x,d.y)):1===this.right_side&&(this.piecebmd.ctx.lineTo(g.x,Math.floor(g.y-h/3)),this.piecebmd.ctx.lineTo(Math.floor(g.x+.1*o),Math.floor(g.y-h/3)),this.piecebmd.ctx.lineTo(Math.floor(g.x+.15*o),Math.floor(g.y-h/3-h/6)),this.piecebmd.ctx.lineTo(Math.floor(g.x+.1*o),Math.floor(g.y-h/3-2*h/6)),this.piecebmd.ctx.lineTo(g.x,Math.floor(g.y-h/3-2*h/6)),this.piecebmd.ctx.lineTo(d.x,d.y)),0===this.top_side?this.piecebmd.ctx.lineTo(m.x,m.y):-1===this.top_side?(this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3),d.y),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3),Math.floor(d.y+.1*o)),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3-o/6),Math.floor(d.y+.15*o)),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3-2*o/6),Math.floor(d.y+.1*o)),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3-2*o/6),d.y),this.piecebmd.ctx.lineTo(m.x,m.y)):1===this.top_side&&(this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3),d.y),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3),Math.floor(d.y-.1*o)),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3-o/6),Math.floor(d.y-.15*o)),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3-2*o/6),Math.floor(d.y-.1*o)),this.piecebmd.ctx.lineTo(Math.floor(d.x-o/3-2*o/6),d.y),this.piecebmd.ctx.lineTo(m.x,m.y)),this.piecebmd.ctx.fill();var u=this.game.add.image(Game.w/2,Game.h/2,n);u.anchor.setTo(.5),u.visible=!1;var p=u.width,x=u.height,b=Math.floor(.15*o),y=Math.floor(.15*h),M=Math.floor(.15*o),T=Math.floor(.15*h);1===this.top_side&&(T=0),1===this.left_side&&(M=0);var w=this.game.make.bitmapData(p,x);area=new Phaser.Rectangle(a*o-Math.abs(M-.15*o),s*h-Math.abs(T-.15*h),p,x),w.copyRect(n,area,M,T),w.update();var _=this.game.make.bitmapData(l,c);_.copyRect(this.piecebmd,area,l,c);var v=this.game.make.bitmapData(l,c);v.alphaMask(w,this.piecebmd),Phaser.Sprite.call(this,this.game,e-b,i-y,v),this.initialX=this.x,this.initialY=this.y,this.inputEnabled=!0,this.input.enableDrag(!0),this.game.add.existing(this)};PuzzlePiece.prototype=Object.create(Phaser.Sprite.prototype),PuzzlePiece.prototype.constructor=PuzzlePiece;var difficulty;Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){difficulty="normal",this.puzzle=new Puzzle(this.game,this.makeBox(500,500),5),this.puzzle.scatter(),this.puzzle.pieces.forEach(function(t){t.inputEnabled=!1,t.input.enableDrag(!1)}),this.game.stage.backgroundColor="#2d2d2d",this.titleText=this.game.add.bitmapText(Game.w/2,Game.h/2-100,"minecraftia","Jigsaw",64),this.titleText.anchor.setTo(.5),this.titleText.tint=65280,this.difficultyButtons=this.game.add.group(),this.easyButton=this.game.add.button(Game.w/2,Game.h/2+75,"easy",this.difficultySelect,this),this.easyButton.anchor.setTo(.5),this.difficultyButtons.add(this.easyButton),this.normalButton=this.game.add.button(Game.w/2,Game.h/2+110,"normal",this.difficultySelect,this),this.normalButton.anchor.setTo(.5),this.normalButton.tint=16711935,this.difficultyButtons.add(this.normalButton),this.hardButton=this.game.add.button(Game.w/2,Game.h/2+155,"hard",this.difficultySelect,this),this.hardButton.anchor.setTo(.5),this.difficultyButtons.add(this.hardButton),this.startButton=this.game.add.button(Game.w/2,Game.h/2+220,"startbtn",this.begin,this,1),this.startButton.anchor.setTo(.5),this.twitterButton=this.game.add.button(this.game.world.centerX,Game.h-50,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.visible=!0},begin:function(){this.game.state.start("Gallery")},difficultySelect:function(t){this.difficultyButtons.forEach(function(t){t.tint=16777215}),t.tint=16711935,difficulty=t.key},makeBox:function(t,e){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle="#0000ff",i.ctx.lineStyle=4,i.ctx.strokeStyle="#ff00ff",i.ctx.fill(),i},twitter:function(){var t="http://www.divideby5.com/games/jigsaw/",e="rantt_",i=[""];window.open("http://twitter.com/share?text=Relax+with+a+fun+Jigsaw+puzzle.+at&via="+e+"&url="+t+"&hashtags="+i.join(","),"_blank")}};var wKey,aKey,sKey,dKey,score=0;Game.Play=function(t){this.game=t},Game.Play.prototype={init:function(){this.physics.startSystem(Phaser.Physics.ARCADE)},create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.game.stage.backgroundColor="#213D5E",this.game_won=!1,"easy"===difficulty?this.square=3:"normal"===difficulty?this.square=5:"hard"===difficulty&&(this.square=10),this.puzzle=new Puzzle(this.game,level.toString(),this.square),this.puzzle.scatter(),this.preview_button=this.game.add.button(Game.w-200,0,this.makeBox(200,50),this.puzzle.preview_toggle,this.puzzle),this.preview_button.tint=16711935,this.game.add.bitmapText(Game.w-170,10,"minecraftia","Preview",24),this.menu_button=this.game.add.button(0,0,this.makeBox(200,50),this.gotoMenu,this),this.menu_button.tint=16711935,this.game.add.bitmapText(50,10,"minecraftia","Menu",24),this.twitterButton=this.game.add.button(this.game.world.centerX,this.game.world.centerY+200,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.visible=!1},gotoMenu:function(){this.game.state.start("Menu")},makeBox:function(t,e){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle="#fff",i.ctx.fill(),i},update:function(){this.puzzle.won===!0&&(this.game.input.onUp.add(this.nextLevel,this),this.win_text=this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","GREAT JOB!\nClick to Play Again.",24),this.win_text.anchor.setTo(.5))},nextLevel:function(){this.game.state.start("Gallery")}};var game=new Phaser.Game(Game.w,Game.h,Phaser.CANVAS,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Gallery",Game.Gallery),game.state.add("Play",Game.Play),game.state.start("Boot");