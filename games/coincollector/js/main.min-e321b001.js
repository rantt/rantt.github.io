function Automata(t,i){this.width=Math.floor(t),this.height=Math.floor(i),this.lifeCycles=0,this.cells=[],this.minimumLifeCycles=30,this.spawnChance=7,this.floorCount=0,this.resetMap()}function rand(t,i){return Math.floor(Math.random()*(i-t+1))+t}Automata.prototype.resetMap=function(){this.map=[];for(var t=0;t<this.height;t++){this.map.push([]),this.map[t].push(new Array(this.width));for(var i=0;i<this.width;i++)this.map[t][i]=WALL}},Automata.prototype.countTile=function(t){for(var i=0,e=0;e<this.height;e++)for(var a=0;a<this.width;a++)this.map[e][a]===t&&i++;return i},Automata.prototype.print=function(){for(var t="",i=0;i<this.height;i++){for(var e=0;e<this.width;e++){var a="";a=this.map[i][e]===WALL?"#":".",t+=a}t+="\n"}return t},Automata.prototype.csv=function(){for(var t="",i=0;i<this.height;i++){for(var e=0;e<this.width;e++)t+=this.map[i][e],e<this.width-1&&(t+=",");t+="\n"}return t},Automata.prototype.addCell=function(t,i){var e=t||Math.floor(this.width/2),a=i||Math.floor(this.height/2),s=new Cell(e,a,this.map[a][e]);this.map[s.y][s.x]=FLOOR,this.floorCount++,this.cells.push(s)},Automata.prototype.step=function(){for(var t=0;t<this.cells.length;t++){var i=this.cells[t];if(i.alive){if(this.lifeCycles+=1,this.map=i.cycle(this.map),Math.floor(100*Math.random())<=this.spawnChance&&i.neighbours(this.map).length>0){var e=i.neighbours(this.map)[Math.floor(Math.random()*i.neighbours(this.map).length)];this.addCell(e.x,e.y)}}else{var a=this.cells.indexOf(i);a>-1&&this.cells.splice(a,1)}}},Automata.prototype.generate=function(){for(0===this.cells.length&&this.addCell();this.cells.length>0;)for(var t=0;t<this.cells.length;t++){var i=this.cells[t];if(i.alive){if(this.lifeCycles+=1,this.map=i.cycle(this.map),Math.floor(100*Math.random())<=this.spawnChance&&i.neighbours(this.map).length>0){var e=i.neighbours(this.map)[Math.floor(Math.random()*i.neighbours(this.map).length)];this.addCell(e.x,e.y)}}else{var a=this.cells.indexOf(i);a>-1&&this.cells.splice(a,1)}}this.lifeCycles<this.minimumLifeCycles&&(console.log("reset lifecycle =>"+this.lifeCycles),this.lifeCycles=0,this.resetMap(),this.generate())},Automata.prototype.cleanup=function(){for(var t=0;t<this.height;t++)for(var i=0;i<this.width;i++){var e=new Cell(i,t,this.map[t][i]);e.allowDiagonals=!0,e.neighbours(this.map).length<1&&(this.map[t][i]=FLOOR)}};var Cell=function(t,i,e){this.alive=!0,this.allowDiagonals=!1,this.cycleLimit=30,this.x=t,this.y=i};Cell.prototype={north:function(){var t=this.x,i=this.y-1,e="north";return{x:t,y:i,direction:e}},north_east:function(){var t=this.x+1,i=this.y-1,e="north east";return{x:t,y:i,direction:e}},east:function(){var t=this.x+1,i=this.y,e="east";return{x:t,y:i,direction:e}},south_east:function(){var t=this.x+1,i=this.y+1,e="south east";return{x:t,y:i,direction:e}},south:function(){var t=this.x,i=this.y+1,e="south";return{x:t,y:i,direction:e}},south_west:function(){var t=this.x-1,i=this.y+1,e="south west";return{x:t,y:i,direction:e}},west:function(){var t=this.x-1,i=this.y,e="west";return{x:t,y:i,direction:e}},north_west:function(){var t=this.x-1,i=this.y-1,e="north west";return{x:t,y:i,direction:e}},moveTo:function(t){this.x=t.x,this.y=t.y},cycle:function(t){var i=this.neighbours(t)[Math.floor(Math.random()*this.neighbours(t).length)];return this.alive&&(this.x=i.x,this.y=i.y,t[i.y][i.x]=FLOOR),t}},Cell.prototype.checkNeighbour=function(t,i){var e=i[0].length,a=i.length;try{return!(t.x<0||t.y<0||t.x>e||t.y>a||i[t.y][t.x]===FLOOR)}catch(s){}},Cell.prototype.neighbours=function(t){var i=[];return this.checkNeighbour(this.north(),t)&&i.push(this.north()),this.checkNeighbour(this.east(),t)&&i.push(this.east()),this.checkNeighbour(this.south(),t)&&i.push(this.south()),this.checkNeighbour(this.west(),t)&&i.push(this.west()),0===i.length&&(this.alive=!1),i};var wKey,aKey,sKey,dKey,Player=function(t,i,e){this.game=t,this.edgeTimer=0,this.jumpTimer=0,this.swapTimer=0,this.JUMP_SPEED=-350,this.MOVE_SPEED=150,this.standing=!1,this.jumping=!1,Phaser.Sprite.call(this,this.game,i,e,"player"),this.game.add.existing(this),this.health=100,this.game.physics.arcade.enable(this),this.anchor.setTo(.5,.5),this.body.setSize(10,18),this.body.collideWorldBounds=!0,this.body.gravity.y=750,this.game.camera.follow(this,Phaser.Camera.FOLLOW_PLATFORMER),this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN]),spaceKey=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.cursors=this.game.input.keyboard.createCursorKeys()};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.leftInputIsActive=function(){var t=!1;return t=this.game.input.keyboard.isDown(Phaser.Keyboard.A),t|=this.game.input.keyboard.isDown(Phaser.Keyboard.LEFT)},Player.prototype.rightInputIsActive=function(){var t=!1;return t=this.game.input.keyboard.isDown(Phaser.Keyboard.D),t|=this.game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)},Player.prototype.upInputIsActive=function(t){var i=!1;return i=this.game.input.keyboard.downDuration(Phaser.Keyboard.W,t),i|=this.game.input.keyboard.downDuration(Phaser.Keyboard.UP,t)},Player.prototype.upInputRelease=function(){var t=!1;return t=this.game.input.keyboard.upDuration(Phaser.Keyboard.W),t|=this.game.input.keyboard.upDuration(Phaser.Keyboard.UP)},Player.prototype.movements=function(){this.standing=this.body.blocked.down||this.body.touching.down,this.touchingLeft=this.body.blocked.left||this.body.touching.left,this.touchingRight=this.body.blocked.right||this.body.touching.right,this.standing&&(this.jumps=2,this.jumping=!1),this.leftInputIsActive()?(this.facing=1,this.frame=4,this.body.velocity.x=-this.MOVE_SPEED):this.rightInputIsActive()?(this.facing=-1,this.frame=3,this.body.velocity.x=this.MOVE_SPEED):(this.frame=0,this.body.velocity.x=0),this.touchingLeft&&!this.standing?(this.sliding=!0,this.frame=1):this.touchingRight&&!this.standing?(this.sliding=!0,this.frame=2):this.sliding=!1,this.jumps>0&&this.upInputIsActive(5)&&(this.body.velocity.y=this.JUMP_SPEED,this.jumping=!0),this.sliding&&this.upInputIsActive(5)&&(this.jumps++,this.game.add.tween(this).to({x:this.x+50*this.facing},100,Phaser.Easing.Linear.Out,!0,0),this.body.velocity.y=this.JUMP_SPEED,this.jumping=!0),this.jumping&&this.upInputRelease()&&(this.jumps--,this.jumping=!1)},Player.prototype.constructor=Player;var TILE_SIZE=20,ROWS=24,COLS=24,Game={w:TILE_SIZE*COLS,h:TILE_SIZE*ROWS};Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml"),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.maxHeight=window.innerHeight,this.game.scale.maxWidth=window.innerHeight*(Game.w/Game.h)},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=(this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","Loading...",30).anchor.setTo(.5),this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading"));this.game.load.setPreloadSprite(t),this.game.load.image("twitter","assets/images/twitter.png"),this.game.load.tilemap("level1","assets/atlas/level1.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.tilemap("level2","assets/atlas/level2.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.tilemap("level3","assets/atlas/level3.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.spritesheet("tiles","assets/images/tiles.png",20,20,7),this.game.load.spritesheet("player","assets/images/player.png",20,20,5),this.game.load.audio("music","assets/audio/cannontube_loop_medium.ogg"),this.game.load.audio("coin","assets/audio/coin.wav")},create:function(){this.game.state.start("Menu")}},Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){FLOOR=2,WALL=3,this.auto=new Automata(COLS,ROWS),this.auto.generate(),this.auto.cleanup(),coin_limit=Math.floor(.2*this.auto.floorCount);for(var t=0;t<coin_limit;t++){var i=rand(3,COLS-4),e=rand(3,ROWS-4);this.auto.map[e][i]===FLOOR&&this.auto.map[e-1][i]===FLOOR&&this.auto.map[e+1][i]===FLOOR&&this.auto.map[e][i-1]===FLOOR&&this.auto.map[e][i+1]&&(this.auto.map[e][i]=5)}var a=this.auto.csv();this.game.load.tilemap("level",null,a,Phaser.Tilemap.CSV),this.map=this.game.add.tilemap("level",TILE_SIZE,TILE_SIZE),this.map.addTilesetImage("tiles"),this.map.setTileIndexCallback(5,this.collectCoin,this),this.layer=this.map.createLayer(0),this.map.setCollision(0),this.layer.resizeWorld(),this.titleText=this.game.add.bitmapText(Game.w/2,Game.h/2-100,"minecraftia","Coin Collector",42),this.titleText.anchor.setTo(.5),this.titleText.tint=16776960,this.game.add.tween(this.titleText).to({y:100},2e3,Phaser.Easing.Linear.In,!0,0,-1).yoyo(!0);var s=this.game.add.bitmapText(Game.w/2,Game.h-100,"minecraftia","Controls:\nWASD/Arrows\nw/ Double Jumps and Wall Jumps!",18);s.anchor.setTo(.5);var o=this.game.add.bitmapText(Game.w/2,Game.h-10,"minecraftia","Music: Cannon Tube by Gundatsch",18);o.anchor.setTo(.5),o.inputEnabled=!0,o.events.onInputDown.add(function(){window.open("http://opengameart.org/content/cannon-tube")},this),o.events.onInputOver.add(function(){o.tint=16776960},this),o.events.onInputOut.add(function(){o.tint=16777215},this);this.game.add.bitmapText(Game.w/2,Game.h/2+50,"minecraftia","~click to start~",24).anchor.setTo(.5)},update:function(){this.game.input.activePointer.isDown&&this.game.state.start("Play")}};var wKey,aKey,sKey,dKey,coin_count=0,coins=0,FLOOR,WALL,dFloor,dRows,dCols;Game.Play=function(t){this.game=t},Game.Play.prototype={init:function(){this.game.physics.startSystem(Phaser.Physics.ARCADE)},create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.stage.backgroundColor="#716A74",this.coinSnd=this.game.add.sound("coin"),this.coinSnd.volume=.2,this.music=this.game.add.sound("music"),this.music.volume=.3,this.music.loop=!0,this.music.play(),FLOOR=2,WALL=3,this.auto=new Automata(2*COLS,2*ROWS),this.auto.generate(),this.auto.cleanup(),coin_limit=Math.floor(.4*this.auto.floorCount);for(var t=0;t<coin_limit;t++){var i=rand(2,2*COLS-2),e=rand(2,2*ROWS-2);this.auto.map[e][i]===FLOOR&&this.auto.map[e-1][i]===FLOOR&&this.auto.map[e+1][i]===FLOOR&&this.auto.map[e][i-1]===FLOOR&&this.auto.map[e][i+1]&&(this.auto.map[e][i]=5)}coin_count=this.auto.countTile(5),void 0!==coin_count&&0!==coin_count||this.game.state.start("Play");var a=this.auto.csv();this.game.load.tilemap("level",null,a,Phaser.Tilemap.CSV),this.map=this.game.add.tilemap("level",TILE_SIZE,TILE_SIZE),this.map.addTilesetImage("tiles"),this.map.setTileIndexCallback(5,this.collectCoin,this),this.layer=this.map.createLayer(0),this.map.setCollision(WALL),this.layer.resizeWorld(),this.coinsText=this.game.add.bitmapText(Game.w-200,10,"minecraftia","Coins: "+coins+"/"+coin_count,24),this.coinsText.tint=16776960,this.coinsText.fixedToCamera=!0;for(var s=!0;s;){var i=rand(2,2*COLS-2),e=rand(2,2*ROWS-2);this.auto.map[e][i]===FLOOR&&(this.player=new Player(this.game,i*TILE_SIZE,e*TILE_SIZE),s=!1)}wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),this.cursors=this.game.input.keyboard.createCursorKeys(),this.twitterButton=this.game.add.button(this.game.world.centerX,this.game.world.centerY+200,"twitter",this.twitter,this),this.twitterButton.fixedToCamera=!0,this.twitterButton.anchor.set(.5),this.twitterButton.visible=!1},collectCoin:function(t,i){this.coinSnd.play(),coins++,i.index=FLOOR,this.layer.dirty=!0},update:function(){coin_count>coins?(this.game.physics.arcade.collide(this.player,this.layer),this.coinsText.setText("Coins: "+coins+"/"+coin_count),this.player.movements()):coin_count>0&&coins>=coin_count?(this.music.stop(),this.game.state.start("Win")):this.game.state.start("Play")},twitter:function(){var t="http://www.divideby5.com/games/coincollector/",i="rantt_",e=[""];window.open("http://twitter.com/share?text=I+Beat+Coin+Collector+See+if+you+can+beat+it.+at&via="+i+"&url="+t+"&hashtags="+e.join(","),"_blank")}},Game.Win=function(t){this.game=t},Game.Win.prototype={create:function(){this.game.stage.backgroundColor="#716A74",this.wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),this.cursors=this.game.input.keyboard.createCursorKeys(),this.twitterButton=this.game.add.button(Game.w/2,Game.h/2+100,"twitter",this.twitter,this),this.twitterButton.fixedToCamera=!0,this.twitterButton.anchor.set(.5),this.twitterButton.visible=!1,this.playAgainText=this.game.add.bitmapText(Game.w+200,Game.h/2,"minecraftia","You WIN!\nPlay Again?",48),this.playAgainText.anchor.set(.5),this.game.time.events.add(.5*Phaser.Timer.SECOND,function(){this.game.add.tween(this.playAgainText).to({x:Game.w/2},355,Phaser.Easing.Linear.None).start(),this.twitterButton.visible=!0},this)},update:function(){(this.game.input.activePointer.isDown||this.wKey.isDown||this.cursors.up.isDown)&&(coins_count=0,coins=0,this.game.state.start("Play"))},twitter:function(){var t="http://www.divideby5.com/games/GAMETITLE/",i="rantt_",e=[""];window.open("http://twitter.com/share?text=My+best+score+is+"+score+"+playing+GAME+TITLE+See+if+you+can+beat+it.+at&via="+i+"&url="+t+"&hashtags="+e.join(","),"_blank")}};var game=new Phaser.Game(Game.w,Game.h,Phaser.AUTO,"game");game.state.add("Boot",Game.Boot),game.state.add("Win",Game.Win),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Play",Game.Play),game.state.start("Boot");