Phaser.Plugin.ScreenShake=function(t,e){Phaser.Plugin.call(this,t,e),this.shakeWorld=0},Phaser.Plugin.ScreenShake.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.ScreenShake.prototype.constructor=Phaser.Plugin.ScreenShake,Phaser.Plugin.ScreenShake.prototype.start=function(t,e,i){this.x="undefined"!=typeof e?e:20,this.y="undefined"!=typeof i?i:20,this.shakeWorld=t,console.log(this.shakeWorld)},Phaser.Plugin.ScreenShake.prototype.postUpdate=function(){if(this.shakeWorld>0){var t=this.game.rnd.integerInRange(-this.x,this.x),e=this.game.rnd.integerInRange(-this.y,this.y);this.game.world.setBounds(t,e,this.game.width+t,this.game.height+e),this.shakeWorld--,0==this.shakeWorld&&this.game.world.setBounds(0,0,this.game.width,this.game.height)}};var Game={w:768,h:1024};Game.Boot=function(t){this.game=t},Game.Boot.prototype={preload:function(){this.game.stage.backgroundColor="#213D5E",this.game.load.image("loading","assets/images/loading.png"),this.game.load.image("title","assets/images/title.png"),this.game.load.image("instructions","assets/images/instructions.png"),this.game.load.bitmapFont("minecraftia","assets/fonts/font.png","assets/fonts/font.xml"),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.maxHeight=window.innerHeight,this.game.scale.maxWidth=window.innerHeight*(Game.w/Game.h)},create:function(){this.game.state.start("Load")}},Game.Load=function(t){this.game=t},Game.Load.prototype={preload:function(){var t=this.game.plugins.add(Phaser.Plugin.ScreenShake);this.game.plugins.ScreenShake=t;var e=this.game.add.text(Game.w,Game.h,"Loading...",{font:"30px Helvetica",fill:"#000"});e.anchor.setTo(.5,.5);var i=this.game.add.sprite(Game.w/2-64,Game.h/2+50,"loading");this.game.load.setPreloadSprite(i),this.game.load.atlasXML("shapes","assets/images/shapes.png","assets/atlas/shapes.xml"),this.game.load.atlasXML("startbtn","assets/images/startbtn.png","assets/atlas/startbtn.xml"),this.game.load.image("twitter","assets/images/twitter.png"),this.game.load.image("easy","assets/images/easy.png"),this.game.load.image("normal","assets/images/normal.png"),this.game.load.image("hard","assets/images/hard.png"),this.game.load.audio("score","assets/audio/score.wav"),this.game.load.audio("fail","assets/audio/fail.wav"),this.game.load.audio("lost","assets/audio/lost.wav")},create:function(){this.game.state.start("Menu")}};var difficulty="normal";Game.Menu=function(t){this.game=t},Game.Menu.prototype={create:function(){this.game.stage.backgroundColor="#192331",this.titleText=this.game.add.bitmapText(Game.w/2,Game.h/2-100,"minecraftia","PREfectionist",64),this.titleText.anchor.setTo(.5),this.titleText.tint=16776960,this.game.add.tween(this.titleText).to({angle:15},1e3,Phaser.Easing.Linear.In).to({angle:-15},1e3,Phaser.Easing.Linear.In).start(),this.difficultyButtons=this.game.add.group(),this.easyButton=this.game.add.button(Game.w/2,Game.h/2+75,"easy",this.difficultySelect,this),this.easyButton.anchor.setTo(.5),this.difficultyButtons.add(this.easyButton),this.normalButton=this.game.add.button(Game.w/2,Game.h/2+110,"normal",this.difficultySelect,this),this.normalButton.anchor.setTo(.5),this.normalButton.tint=16776960,this.difficultyButtons.add(this.normalButton),this.hardButton=this.game.add.button(Game.w/2,Game.h/2+155,"hard",this.difficultySelect,this),this.hardButton.anchor.setTo(.5),this.difficultyButtons.add(this.hardButton),this.startButton=this.game.add.button(Game.w/2,Game.h/2+220,"startbtn",this.begin,this,1),this.startButton.anchor.setTo(.5)},begin:function(){this.game.state.start("Play")},difficultySelect:function(t){this.difficultyButtons.forEach(function(t){t.tint=16777215}),t.tint=16776960,difficulty=t.key},makeButton:function(t,e,i){var s=this.game.add.bitmapData(t,e);return s.ctx.beginPath(),s.ctx.rect(0,0,t,e),s.ctx.fillStyle="#000",s.ctx.fill(),s}},Shape=function(t,e,i,s,a){a=a||16776960,Phaser.Sprite.call(this,t,e+Game.w,i,"shapes",s),this.initialX=e,this.initialY=i,this.anchor.setTo(.5),this.tint=a,this.inSlot=!1,this.inputEnabled=!0,this.input.enableDrag(!0)},Shape.prototype=Object.create(Phaser.Sprite.prototype),Shape.prototype.constructor=Shape,Slot=function(t,e,i,s,a){a=a||16776960,Phaser.Sprite.call(this,t,e,i,"shapes",s),this.initialX=e,this.initialY=i,this.anchor.setTo(.5),this.tint=a},Slot.prototype=Object.create(Phaser.Sprite.prototype),Slot.prototype.constructor=Slot,Board=function(t,e){this.game=t,this.slots=t.add.group(),this.tiles=t.add.group();for(var i=1,s=1;shape_count>i;)i=Math.pow(s,2),s+=1;for(var a=Math.sqrt(i),n=(Game.w-160*(a-1))/2,o=0,h=0;a>h;h++)for(var r=0;a>r;r++){if(void 0!==e[o]){var l=n+160*r,d=310+160*h,m=this.game.add.sprite(l,d,"shapes",0);m.anchor.setTo(.5,.5),m.tint=14474460,m.alpha=.5,this.tiles.add(m),this.slots.add(new Slot(this.game,l,d,e[o],14474460))}o+=1}};var TwitterButton=function(t){Phaser.Button.call(this,t,t.world.centerX,t.world.centerY+200,"twitter"),console.log(this)};TwitterButton.prototype=Object.create(Phaser.Button.prototype),TwitterButton.prototype.sendMsg=function(){var t="http://www.divideby5.com/games/GAMETITLE/",e="rantt_",i=["1GAM"];window.open("http://twitter.com/share?text=My+best+score+is+"+score+"+playing+GAME+TITLE+See+if+you+can+beat+it.+at&via="+e+"&url="+t+"&hashtags="+i.join(","),"_blank")},TwitterButton.prototype.constructor=TwitterButton;var wKey,aKey,sKey,dKey,level=1,adjustDifficulty=0,retries=0,shape_count,shapes_left,slots,tiles,shapes,limit;Game.Play=function(t){this.game=t},Game.Play.prototype={create:function(){this.game.world.setBounds(0,0,Game.w,Game.h),this.game.stage.backgroundColor="#192331",this.setDifficulty(),this.showing_message=!0,this.holding_pointer=!1,this.winning=!0,this.scoreSnd=this.game.add.sound("score"),this.scoreSnd.volume=.2,this.failSnd=this.game.add.sound("fail"),this.failSnd.volume=.2,this.lostSnd=this.game.add.sound("lost"),wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),this.message_screen=this.game.add.sprite(Game.w/2,Game.h/2,this.makeBox(Game.w,Game.h)),this.message_screen.anchor.setTo(.5),this.message_screen.tint=2236962,this.message_screen.alpha=.5,this.message_screen.visible=!1,this.message_text=this.game.add.bitmapText(Game.w/2,Game.h/2,"minecraftia","Level "+level,48),this.message_text.anchor.setTo(.5),this.message_text.visible=!1,this.twitterButton=this.game.add.button(this.game.world.centerX,this.game.world.centerY+200,"twitter",this.twitter,this),this.twitterButton.anchor.set(.5),this.twitterButton.visible=!1},setDifficulty:function(){"easy"===difficulty?limit=5e3:"normal"===difficulty?limit=3e3:"hard"===difficulty&&(limit=1500)},loadLevel:function(t){1===t?shapes_left=shape_count=4:2===t?shapes_left=shape_count=9:3===t?shapes_left=shape_count=16:4===t&&(shapes_left=shape_count=25);var e=this.makeBox(this.game.width,30);this.count_down=this.game.add.sprite(Game.w/2,200,e),this.count_down.anchor.setTo(.5),this.time_limit=this.game.time.now+limit;for(var i=[],s=1;31>s;s++)i.push(s);for(var a=[];a.length<shape_count;){var n=Math.floor(Math.random()*i.length);a.push(i.splice(n,1)[0])}this.shapes_deck=this.shuffle(a),this.slots_deck=this.shuffle(a),this.board=new Board(this.game,this.slots_deck),slots=this.board.slots,tiles=this.board.tiles,shapes=this.game.add.group();for(var o=1;shape_count>=o;o++){var h=96*o,r=100,l=new Shape(this.game,h,r,this.shapes_deck[o-1]);l.events.onDragStop.add(this.onDragStop,this),shapes.add(l),this.game.add.tween(l).to({x:l.initialX,y:l.initialY},100,Phaser.Easing.Linear.Out,!0,0)}},makeBox:function(t,e){var i=this.game.add.bitmapData(t,e);return i.ctx.beginPath(),i.ctx.rect(0,0,t,e),i.ctx.fillStyle="#fff",i.ctx.fill(),i},shuffle:function(t){for(var e=t.slice(),i=[];e.length>0;){var s=Math.floor(Math.random()*e.length);i.push(e.splice(s,1)[0])}return i},onDragStop:function(t,e){for(var i,s=0;s<slots.length;s++)if(slots.children[s].frame===t.frame){i=slots.children[s],tile=tiles.children[s];break}if(boundsShape=t.getBounds(),boundsSlot=i.getBounds(),Phaser.Rectangle.intersects(boundsShape,boundsSlot)){this.scoreSnd.play(),this.game.add.tween(t).to({x:i.initialX,y:i.initialY},50,Phaser.Easing.Linear.Out,!0,0),tile.tint=16776960,t.input.enableDrag(!1),t.inputEnabled=!1,t.inSlot=!0,shapes_left-=1,this.time_limit=this.game.time.now+limit;for(var a=0,s=0;s<shapes.length;s++){var n=shapes.children[s];n.frame!==t.frame&&n.inSlot===!1&&(n.initialX=100+96*a,this.game.add.tween(n).to({x:n.initialX},50,Phaser.Easing.Linear.Out,!0,0),a+=1)}}else this.failSnd.play(),this.game.add.tween(t).to({x:t.initialX,y:t.initialY},200,Phaser.Easing.Linear.Out,!0,0)},update:function(){if(this.game.input.activePointer.isUp&&(this.holding_pointer=!1),5===level)this.message_screen.visible=!0,this.twitterButton.visible=!0,this.message_text.visible=!0,this.message_text.setText("You WIN! With "+retries+" retries.\nDifficulty "+difficulty+"\nClick To Play Again!"),this.game.input.activePointer.isDown&&this.holding_pointer===!1&&(level=1,this.game.state.start("Menu"));else if(this.showing_message===!0)if(this.game.input.activePointer.isDown&&this.holding_pointer===!1)this.holding_pointer=!0,this.showing_message=!1,this.level_loaded=!1,this.message_text.visible=!1;else{var t="";this.winning===!1&&(t="Try Again?"),this.message_screen.visible=!0,this.message_text.setText(t+"\nLevel "+level+"\nClick To Start!"),this.message_text.visible=!0}else this.level_loaded===!1&&(this.loadLevel(level),this.level_loaded=!0),this.game.time.now>this.time_limit&&(("easy"===difficulty||"normal"===difficulty)&&(adjustDifficulty+=1,3===adjustDifficulty&&(limit+=1e3,adjustDifficulty=0)),retries+=1,this.winning=!1,this.lostSnd.play(),this.game.plugins.ScreenShake.start(40),this.holding_pointer=!0,shape_count=shapes_left=25,this.level_loaded=!1,this.showing_message=!0,this.resetGame()),0===shapes_left&&(this.winning=!0,level+=1,this.level_loaded=!1,this.showing_message=!0,this.setDifficulty(),this.resetGame()),this.count_down.scale.x=(this.time_limit-this.game.time.now)/limit,this.count_down.scale.x>.7?this.count_down.tint=65280:this.count_down.scale.x>.3?this.count_down.tint=16776960:this.count_down.scale.x>0&&(this.count_down.tint=16711680)},resetGame:function(){this.count_down.kill(),tiles.forEach(function(t){t.kill()}),shapes.forEach(function(t){t.kill()}),slots.forEach(function(t){t.kill()})},twitter:function(){var t="http://www.divideby5.com/games/prefectionist/",e="rantt_",i=[""];window.open("http://twitter.com/share?text=I+beat+PREfectionist+on+"+difficulty+"+mode+with+"+retries+"+retries+See+if+you+can+beat+it.+at&via="+e+"&url="+t+"&hashtags="+i.join(","),"_blank")}};var game=new Phaser.Game(Game.w,Game.h,Phaser.AUTO,"game");game.state.add("Boot",Game.Boot),game.state.add("Load",Game.Load),game.state.add("Menu",Game.Menu),game.state.add("Play",Game.Play),game.state.start("Boot");